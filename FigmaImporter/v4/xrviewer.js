/*! For license information please see xrviewer.js.LICENSE.txt */
(()=>{"use strict";var e,t={2608:(e,t,n)=>{var r,o,i,a,c,u,l,s=n(7294),f=n(745),h=n(9477),d=n(1184),p=n(5953),m=n(8412),v=n(2788);function g(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var y=(0,v.vJ)(r||(r=g(["\n    body {\n        font-family: sans-serif;\n        font-size: 10px;\n        text-align: center;\n        /* margin: 20px; */\n        margin:0px !important;\n        color: #ccc;\n        background-color: #121212;\n        overflow: hidden;\n        height: 100vh;\n    }\n    .xr-button{\n        border-radius: 8px;\n        opacity: 1;\n        user-select: auto;\n        padding: 8px 12px 8px 12px;\n        font-family: sans-serif;\n        border-radius: 100px;\n        line-height: 10px;\n        font-size: 10px;\n\n        box-shadow: 0 3px 4px -1px rgb(0 0 0 / 48%);\n        color: rgba(255,255,255,0.9);\n        background: rgba(29,53,59,0.7);\n        backdrop-filter: blur(14px);\n        border-bottom: 1px solid rgba(255,255,255,0.08);\n        margin:15px 5px;\n        z-index: 11;\n        cursor: pointer;\n    }\n\n    .xr-button:hover{\n        background: linear-gradient(99deg, rgb(7, 136, 255) 0%, rgb(153, 0, 255) 100%);\n        border-bottom: 1px solid rgba(255,255,255,0.24);\n    }\n"]))),b=v.ZP.div(o||(o=g(["\n    display: flex;\n    flex-direction: row-reverse;\n"]))),x=v.ZP.div(i||(i=g(["\n    width: 100%;\n    gap: 1rem;\n    overflow-x: auto;\n    scroll-snap-type: x;\n    z-index: 100;\n    bottom: 0px;\n    max-height: 140px;\n    height: 140px;\n    display: flex;\n    flex: 1;\n    position: absolute;\n"]))),w=v.ZP.img(a||(a=g(["\n    scroll-snap-align: start;\n    flex: 0 0 100px;\n    width: 100px;\n    height: 100px;\n    border-radius: 5px;\n    object-fit: contain;\n    background: #ffffff40;\n    padding: 12px;\n"]))),j=v.ZP.div(c||(c=g(["\n    position: absolute;\n    left: 50%;\n    top: 0px;\n    transform: translate(-50%, 0);\n    margin: 0 auto;\n    z-index: 10;\n    display:flex;\n"]))),S=v.ZP.div(u||(u=g(["\n    border-radius: 8px;\n    opacity: 1;\n    user-select: auto;\n    padding: 8px 12px 8px 12px;\n    font-family: 'Inter', sans-serif;\n    border-radius: 100px;\n    line-height: 10px;\n    font-size: 10px;\n\n    box-shadow: 0 3px 4px -1px rgb(0 0 0 / 48%);\n    color: rgba(255,255,255,0.9);\n    background: rgba(29,53,59,0.7);\n    backdrop-filter: blur(14px);\n    border-bottom: 1px solid rgba(255,255,255,0.08);\n    margin:15px 5px;\n    z-index: 11;\n    cursor: pointer;\n\n    &:hover {\n        background: linear-gradient(99deg, rgb(7, 136, 255) 0%, rgb(153, 0, 255) 100%);\n        border-bottom: 1px solid rgba(255,255,255,0.24);\n    }\n"]))),L=v.ZP.div(l||(l=g(["\n    flex: 1;\n    height:100vh;\n"]))),E=n(3577),O=n(6037),k=n(5893);function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const R=function(e){var t,n,r=e.cameraSheetObj,o=(0,s.useRef)(null),i=(t=(0,s.useState)(!0),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],c=i[1];return(0,d.A)((function(){r.value.control?c(!0):c(!1)})),(0,k.jsx)(k.Fragment,{children:a?(0,k.jsx)(O.z,{ref:o}):(0,k.jsx)(k.Fragment,{})})};var _=n(1767),A=n(5062),F=n(7395);function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var D=(0,F.Ah)(_.c,"perspectiveCamera");const U=function(e){var t,n,r=e.cameraRef,o=e.containerRef,i=e.cameraSheetObj,a=e.baseUnit,c=(t=(0,s.useState)(1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],l=c[1],f=(0,s.useRef)(null);(0,A.H)(r,h.CameraHelper);var p=(0,d.z)(),m=p.invalidate;return p.scene,(0,s.useEffect)((function(){var e=o.current.clientWidth,t=o.current.clientHeight;console.log("aspect: "+e/t),l(e/t),i.current.onValuesChange((function(e){e.control?m():f.current&&(f.current.position.x=e.position.x,f.current.position.y=e.position.y,f.current.position.z=e.position.z,f.current.rotation.x=e.rotation.x,f.current.rotation.y=e.rotation.y,f.current.rotation.z=e.rotation.z,f.current.scale.x=e.scale.x,f.current.scale.y=e.scale.y,f.current.scale.z=e.scale.z,f.current.near=e.near,f.current.far=e.far,f.current.fov=e.fov,f.current.zoom=e.zoom,f.current.matrixWorldNeedsUpdate=!0,f.current.updateProjectionMatrix(),f.current.updateMatrixWorld(),m())}))}),[]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(_.c,{ref:f,makeDefault:!0,fov:60,aspect:u,near:.01,zoom:1,far:1e4,position:[0,0,a]}),(0,k.jsx)(D,{theatreKey:"camera",objRef:i,ref:r,additionalProps:{control:!0},fov:60,aspect:u,near:.01,zoom:1,far:1e4,position:[0,0,a]})]})};var z=n(2162),M=n(5166);function C(e,t,n){return e.find((function(e){return e.type===n}))||null}function I(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))}const H=function(e){e.cameraRef;var t=e.cameraSheetObj,n=e.children,r=(0,d.z)(),o=r.invalidate,i=r.scene,a=(r.gl,r.camera,function(){var e=(0,m.nH)(),n=e.player,r=e.isPresenting;return e.session,(0,s.useEffect)((function(){var e=i.children;if(r){n.visible=!1,C(e,0,"CameraHelper").visible=!1;var a=Math.sqrt(3),c=t.current.value.position.x,u=t.current.value.position.y,l=t.current.value.position.z,s=t.current.value.rotation.x,f=t.current.value.rotation.y,h=t.current.value.rotation.z,d=t.current.value.fov,p=t.current.value.zoom;n.position.x=c,n.position.y=u-1.6,n.position.z=l*Math.tan(d/(2*p)*Math.PI/180)*a,n.rotation.x=s,n.rotation.y=f,n.rotation.z=h,n.children[0].position.y=0,console.log(n),setTimeout((function(){n.visible=!0,o()}),1)}}),[r]),null});return(0,k.jsxs)(m.XR,{children:[(0,k.jsx)(z.z,{}),(0,k.jsx)(M.D,{}),n,(0,k.jsx)(a,{})]})};var B=n(6381),N=n(1217),G=n(2854),W=n(4092);function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var q="https://unpkg.com/three@0.".concat(h.REVISION,".x"),X=(new G._).setDecoderPath("".concat(q,"/examples/js/libs/draco/gltf/")),Y=(new W.a).setTranscoderPath("".concat(q,"/examples/js/libs/basis/")),Q=function(e){var t=(0,s.useRef)(null),n=(0,s.useRef)(null),r=(0,s.useRef)(null),o=V((0,s.useState)(1),2),i=(o[0],o[1],V((0,s.useState)(1),2)),a=i[0],c=i[1],u=V((0,s.useState)(!1),2),l=u[0],f=u[1],p=((0,s.useRef)(null),(0,d.D)(N.E,"".concat(e.modelSrc),(function(t){console.log("finsihed model loading from:"+e.modelSrc),t.setDRACOLoader(X),t.setKTX2Loader(Y)}))),m=(0,s.useRef)(new h.AnimationMixer(p.scene));return(0,s.useEffect)((function(){if(e.hasData&&0!=e.index){var t=(new h.Box3).setFromObject(n.current),r=t.max.x-t.min.x;c(1/r*e.baseUnit),n.current.traverse((function(e){e.hasOwnProperty("material")&&(e.material.userData.hasOwnProperty("originalColor")||(e.material.userData.originalColor=e.material.color))})),f(!0),console.log("finsihed data setting")}p.animations.forEach((function(e){return m.current.clipAction(e).play()}))}),[e.src,e.hasData]),(0,d.A)((function(e,t){var n;null==m||null===(n=m.current)||void 0===n||n.update(t),(0,d.l)()})),(0,k.jsx)(F.Ah.group,{theatreKey:e.name,name:e.name,onPointerOver:(0,s.useCallback)((function(e){n.current.traverse((function(e){e.hasOwnProperty("material")&&(e.material.color={isColor:!0,r:1,g:.1412632911304446,b:.45641102317066595})}))}),[]),onPointerOut:(0,s.useCallback)((function(e){n.current.traverse((function(e){e.hasOwnProperty("material")&&(e.material.color=e.material.userData.originalColor)}))}),[]),ref:t,objRef:r,visible:l,scale:l?[a*(e.width/e.frameWidth),a*(e.width/e.frameWidth),a*(e.width/e.frameWidth)]:[1,1,1],position:[(e.x+e.width/2-e.frameWidth/2)/e.frameWidth*e.baseUnit,(e.frameHeight/2-(e.y+e.height/2))/e.frameHeight*(e.frameHeight/e.frameWidth)*e.baseUnit,5e-4*e.index*e.baseUnit],children:(0,k.jsx)("primitive",{ref:n,object:p.scene})})},K=function(e){var t=V((0,s.useState)(!1),2),n=t[0],r=t[1],o=(0,s.useRef)(null),i=(0,s.useRef)(null),a=(0,s.useRef)(null),c=(0,s.useRef)(null),u=V((0,s.useState)(1),2),l=u[0],f=u[1],p=V((0,s.useState)(null),2),m=p[0],v=p[1],g=V((0,s.useState)(!1),2),y=g[0],b=g[1],x=(0,s.useCallback)((function(e){e.needsUpdate=!0,f(e.image.height/e.image.width),e.encoding=h.sRGBEncoding,v(e),b(!0),e.dispose(),(0,d.l)()}),[]);return(0,s.useEffect)((function(){!0===e.isQuery?e.hasData&&(new h.TextureLoader).load(e.src,(function(e){x(e)})):e.hasData?(new h.TextureLoader).load(e.src,(function(e){x(e)})):new Promise((function(e,t){e(function(e,t,n,r,o,i,a){var c=document.createElement("canvas");c.width=n,c.height=r;var u=c.getContext("2d"),l=new e.Texture(c);l.magFilter=e.LinearFilter,l.minFilter=e.LinearMipMapLinearFilter;u.lineWidth=4,u.strokeStyle="white",u.beginPath();for(var s=0;s<=n;s+=213.33333333333334)0===s?(u.moveTo(2,0),u.lineTo(2,r)):(u.moveTo(s-2,0),u.lineTo(s-2,r));for(var f=0;f<=r;f+=120)0===f?(u.moveTo(0,2),u.lineTo(n,2)):(u.moveTo(0,f-2),u.lineTo(n,f-2));return u.stroke(),l.generateMipmaps=!0,l.needsUpdate=!0,l}(h,0,1920,1080).image.toDataURL("image/png"))})).then((function(e){var t=new h.Texture,n=new Image;n.src=e;var r=n;t.image=r,r.onload=function(){x(t)}}))}),[e.src,e.hasData]),(0,s.useEffect)((function(){c.current.onValuesChange((function(e){!function(e,t,n){0==n&&(n=1e-5);for(var r=.5*t.parameters.width,o=new e.Vector2(-r,0),i=new e.Vector2(0,n),a=new e.Vector2(r,0),c=(new e.Vector2).subVectors(o,i),u=(new e.Vector2).subVectors(i,a),l=(new e.Vector2).subVectors(o,a),s=c.length()*u.length()*l.length()/(2*Math.abs(c.cross(l))),f=new e.Vector2(0,n-s),h=2*((new e.Vector2).subVectors(o,f).angle()-.5*Math.PI),d=t.attributes.uv,p=t.attributes.position,m=new e.Vector2,v=0;v<d.count;v++){var g=1-d.getX(v),y=p.getY(v);m.copy(a).rotateAround(f,h*g),p.setXYZ(v,m.x,y,-m.y)}p.needsUpdate=!0}(h,i.current,e.curve)}))}),[a]),(0,k.jsxs)(F.Ah.mesh,{theatreKey:e.name,name:e.name,onPointerOver:(0,s.useCallback)((function(e){return r(!0)}),[]),onPointerOut:(0,s.useCallback)((function(e){return r(!1)}),[]),ref:a,objRef:c,additionalProps:{curve:B.types.number(0,{nudgeMultiplier:.01,range:[0,e.baseUnit]})},visible:y,scale:e.hasData?[e.width/e.frameWidth*1,l*(e.width/e.frameWidth),1]:[1,l,1],position:e.hasData?[(e.x+e.width/2-e.frameWidth/2)/e.frameWidth*e.baseUnit,(e.frameHeight/2-(e.y+e.height/2))/e.frameHeight*(e.frameHeight/e.frameWidth)*e.baseUnit,5e-4*e.index*e.baseUnit]:[0,0,0],children:[(0,k.jsx)("planeGeometry",{ref:i,args:[e.baseUnit,e.baseUnit,40,40]}),(0,k.jsx)("meshBasicMaterial",{ref:o,side:h.DoubleSide,alphaTest:1e-4,transparent:!0,map:m,toneMapped:!1,color:n?0===e.index?"":"hotpink":"white"})]})};const $=function(e){var t=e.figmaData,n=e.isFigma,r=e.isQuery,o=e.baseUnit;return(0,k.jsx)(k.Fragment,{children:0!=t.length?(0,k.jsx)(k.Fragment,{children:t.map((function(e){var t=e.type,i=e.index,a=e.name,c=e.x,u=e.y,l=e.width,s=e.height,f=e.frameWidth,h=e.frameHeight,d=e.src,p=e.modelSrc;return null!=p?(0,k.jsx)(Q,{src:d,name:"#".concat(i,"-")+a.split("/")[a.split("/").length-1].substring(0,24),x:0===i?0:c,y:0===i?0:u,index:i,width:l,height:s,frameWidth:f,frameHeight:h,hasData:!0,isFigma:n,isQuery:r,baseUnit:o,modelSrc:p},t+"-three-"+i):(0,k.jsx)(K,{src:d,name:"#".concat(i,"-")+a.replace(/\//g,"_").replace(/\ /g,"_").substring(0,24),x:0===i?0:c,y:0===i?0:u,index:i,width:l,height:s,frameWidth:f,frameHeight:h,hasData:!0,isQuery:r,baseUnit:o},t+"-three-"+i)}))}):(0,k.jsx)(k.Fragment,{children:!0===r?(0,k.jsx)(k.Fragment,{}):(0,k.jsx)(K,{name:"Screen",hasData:!1,baseUnit:o})})})};function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function ee(){ee=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=x(a,n);if(c){if(c===s)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function h(){}function d(){}var p={};c(p,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(L([])));v&&v!==t&&n.call(v,o)&&(p=v);var g=d.prototype=f.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var u=l(e[o],e,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==J(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,c)}))}c(u.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,s;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=d,c(g,"constructor",d),c(d,"constructor",h),h.displayName=c(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(g),c(g,a,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},e}function te(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function ne(e){return new Promise((function(t){var n=new Image;n.onload=function(){return t(n)},n.src=e}))}function re(e){for(var t=e.split(",")[1],n=atob(t),r=new ArrayBuffer(n.length),o=new Uint8Array(r),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return o}var oe=function(){var e,t=(e=ee().mark((function e(t,n,r,o){return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I(void 0,void 0,void 0,ee().mark((function e(){var i,a,c,u,l;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&t.preventDefault(),e.next=3,n;case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,ne(i);case 8:return a=e.sent,c=a.width,u=a.height,l=re(i),e.abrupt("return",parent.postMessage({pluginMessage:{type:r,name:o,width:c,height:u,blob:l}},"*"));case 13:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){te(i,r,o,a,c,"next",e)}function c(e){te(i,r,o,a,c,"throw",e)}a(void 0)}))});return function(e,n,r,o){return t.apply(this,arguments)}}(),ie=n(5733),ae=n.n(ie),ce=n(3162);function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function le(){le=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=x(a,n);if(c){if(c===s)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function h(){}function d(){}var p={};c(p,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(L([])));v&&v!==t&&n.call(v,o)&&(p=v);var g=d.prototype=f.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var u=l(e[o],e,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==ue(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,c)}))}c(u.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,s;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=d,c(g,"constructor",d),c(d,"constructor",h),h.displayName=c(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(g),c(g,a,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},e}function se(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function fe(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){se(i,r,o,a,c,"next",e)}function c(e){se(i,r,o,a,c,"throw",e)}a(void 0)}))}}function he(e,t){if(t){var n=new(ae()),r=n.folder("pngs"),o=n.folder("models");t.forEach((function(e){var t=fetch(e.url).then((function(e){return 200===e.status?e.blob():Promise.reject(new Error(e.statusText))})),i=e.name+"."+e.ext;"html"===e.ext&&n.file(i,t),"png"===e.ext&&r.file(i,t),"gltf"!==e.ext&&"glb"!==e.ext||o.file(i,t)})),n.generateAsync({type:"blob"}).then((function(t){return(0,ce.saveAs)(t,e)})).then((function(){}))}}function de(e,t){return pe.apply(this,arguments)}function pe(){return(pe=fe(le().mark((function e(t,n){return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch(t).then((function(e){return e.blob()})).then((function(e){var r=new Blob([e],{type:t.includes(".gltf")?"model/gltf+json":"model/gltf-binary"});n(r)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var me=function(){var e=fe(le().mark((function e(t,n,r,o){var i,a;return le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=document.documentElement.innerHTML,a=new Array(r.length),console.log(r),console.log(a),new Promise((function(e,t){if(!0===n)for(var o=0;o<a.length;o++){var c=o;if(a.splice(c,1,{name:r[c].name,width:r[c].width,height:r[c].height,frameWidth:r[c].frameWidth,frameHeight:r[c].frameHeight,x:r[c].x,y:r[c].y,src:null!=r[c].modelSrc?"./pngs/"+"%23".concat(c,"-")+r[c].name.split("/")[r[c].name.split("/").length-1].substring(0,24)+".png":"./pngs/"+"%23".concat(c,"-")+r[c].name.replaceAll(/\//g,"_").replaceAll(/\ /g,"_").substring(0,24)+".png",type:r[c].type,index:r[c].index,id:r[c].id,imageData:null,modelSrc:null!=r[c].modelSrc?"./models/"+"%23".concat(c,"-")+r[c].modelSrc.split("/")[r[c].modelSrc.split("/").length-1]:null}),c===a.length-1){var u=i.replace(/savedFigData = \'\'/g,"savedFigData = ".concat(JSON.stringify(a))).replaceAll('<div id="theatrejs-studio-root" style="position: fixed; inset: 0px; pointer-events: none; z-index: 100;"></div>',"");e({data:u,isServe:!0})}}else!function(){var t=0,n=function(n,o,c){if(a.splice(c,1,{name:r[c].name,width:r[c].width,height:r[c].height,frameWidth:r[c].frameWidth,frameHeight:r[c].frameHeight,x:r[c].x,y:r[c].y,src:o,type:r[c].type,index:r[c].index,id:r[c].id,imageData:null,modelSrc:n}),++t===a.length){var u=i.replace(/savedFigData = \'\'/g,"savedFigData = ".concat(JSON.stringify(a))).replaceAll('<div id="theatrejs-studio-root" style="position: fixed; inset: 0px; pointer-events: none; z-index: 100;"></div>',"");e({data:u,isServe:!1})}},c=function(){var e=o,t=new FileReader;t.readAsDataURL(new Blob([r[e].imageData],{type:"image/png"})),t.onloadend=function(){null!=r[e].modelSrc?de(r[e].modelSrc,(function(r){var o=new FileReader;o.readAsDataURL(r),o.onloadend=function(){n(o.result,t.result,e)}})):n(null,t.result,e)}};for(o=0;o<a.length;o++)c()}()})).then((function(e){if(!0===e.isServe){var t,n;!function(){t=[],n=0,console.log("start");var l=function(e,n,r){return console.log("added"),t.push({url:e,name:n,ext:r}),t},s=function(){++n===a.length&&he("my_project",t)};c=new Blob([e.data],{type:"text/html"}),u=window.URL.createObjectURL(c),t.push({url:u,name:"index",ext:"html"});var f=function(){var e=i;null!=r[e].modelSrc?de(r[e].modelSrc,(function(n){t=l(URL.createObjectURL(n),"#".concat(e,"-")+r[e].modelSrc.split("/")[r[e].modelSrc.split("/").length-1].split(".")[0].substring(0,24),r[e].modelSrc.includes(".gltf")?"gltf":"glb"),t=l(o.children[r.length-1-e].src,"#".concat(e,"-")+r[e].modelSrc.split("/")[r[e].modelSrc.split("/").length-1].substring(0,24),"png"),s()})):(t=l(o.children[r.length-1-e].src,"#".concat(e,"-")+r[e].name.replaceAll(/\//g,"_").replaceAll(/\ /g,"_").substring(0,24),"png"),s())};for(i=0;i<r.length;i++)f()}()}else{var i,c=new Blob([e.data],{type:"text/html"}),u=window.URL.createObjectURL(c);(i=document.createElement("a")).href=u,i.download="index_static.html",i.style="display: none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}));case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}();function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ge(){ge=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=x(a,n);if(c){if(c===s)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function f(){}function h(){}function d(){}var p={};c(p,o,(function(){return this}));var m=Object.getPrototypeOf,v=m&&m(m(L([])));v&&v!==t&&n.call(v,o)&&(p=v);var g=d.prototype=f.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(o,i,a,c){var u=l(e[o],e,i);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==ve(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,a,c)}),(function(e){r("throw",e,a,c)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return r("throw",e,a,c)}))}c(u.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,s;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=d,c(g,"constructor",d),c(d,"constructor",h),h.displayName=c(d,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(u(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(g),c(g,a,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},e}function ye(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){ye(i,r,o,a,c,"next",e)}function c(e){ye(i,r,o,a,c,"throw",e)}a(void 0)}))}}function xe(e,t){return we.apply(this,arguments)}function we(){return(we=be(ge().mark((function e(t,n){var r,o,i;return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:o=e.sent,(i=new FileReader).readAsDataURL(o),i.onloadend=function(){n(i.result)};case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return Se.apply(this,arguments)}function Se(){return(Se=be(ge().mark((function e(t){var n,r;return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.children,r=0;r<t.children.length;r++)!1===t.children[r].visible&&delete n[r];return n=n.filter((function(e){return null!=e&&""!=e})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,t,n,r,o){return Ee.apply(this,arguments)}function Ee(){return Ee=be(ge().mark((function e(t,n,r,o,i){var a,c,u,l,s,f,h,d,p,m,v,g;return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=0,c=!1,u="https://api.figma.com/v1/files/"+"".concat(n,"/nodes?ids=").concat(r),e.next=7,fetch(u,{headers:{Authorization:"Bearer ".concat(t)},method:"GET"});case 7:return l=e.sent,e.next=10,l.json();case 10:return s=e.sent,f=Object.values(s.nodes)[0].document,e.next=14,je(f);case 14:return h=e.sent,d=h.length,p=new Array(d+(c?1:0)),m=function(e,t,n,r,o){fetch("https://api.figma.com/v1/"+"images/".concat(t,"?")+"ids=".concat(n,"&")+"svg_include_id=true&format=png&"+"scale=".concat(1),{headers:{Authorization:"Bearer ".concat(e)},method:"GET"}).then((function(e){return e.json()})).then((function(e){return Object.values(e.images)[0]})).then((function(e){xe(e,(function(e){o({name:r.name,width:r.absoluteRenderBounds.width,height:r.absoluteRenderBounds.height,frameWidth:r.absoluteRenderBounds.width,frameHeight:r.absoluteRenderBounds.height,x:r.absoluteRenderBounds.x-r.absoluteRenderBounds.x,y:r.absoluteRenderBounds.y-r.absoluteRenderBounds.y,src:e,type:"image-framenode",index:0,id:r.id})}))}))},v=function(e,t,n,r,o){for(var i=function(){var i=a;r[i],fetch("https://api.figma.com/v1/"+"images/".concat(t,"?")+"ids=".concat(r[i].id,"&")+"svg_include_id=true&format=png&"+"scale=".concat(1),{headers:{Authorization:"Bearer ".concat(e)},method:"GET"}).then((function(e){return e.json()})).then((function(e){return Object.values(e.images)[0]})).then((function(e){xe(e,(function(e){o({name:r[i].name,width:r[i].absoluteRenderBounds.width,height:r[i].absoluteRenderBounds.height,frameWidth:n.absoluteRenderBounds.width,frameHeight:n.absoluteRenderBounds.height,x:r[i].absoluteRenderBounds.x-n.absoluteRenderBounds.x,y:r[i].absoluteRenderBounds.y-n.absoluteRenderBounds.y,src:e,type:"image-childnode",index:i+(c?1:0),id:r[i].id},i)}))}))},a=0;a<r.length;a++)i()},g=function(){var e=be(ge().mark((function e(i){return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c&&m(t,n,r,f,(function(e){p.splice(0,1,e),console.log("fetched num "+a),console.log("fetched index 0"),a++,o("".concat(a,"/").concat(d+(c?1:0))),i(a)})),v(t,n,f,h,(function(e,t){p.splice(t+(c?1:0),1,e),console.log("fetched num "+a),console.log("fetched index "+"".concat(t+(c?1:0))),a++,o("".concat(a,"/").concat(d+(c?1:0))),i(a)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=22,g((function(e){e===d+(c?1:0)&&i(p)}));case 22:case"end":return e.stop()}}),e)}))),Ee.apply(this,arguments)}var Oe=n(5676),ke=n(6706);function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _e=100,Ae=(0,B.getProject)("XRViewer").sheet("Node Tree","Helper"),Fe=(0,B.getProject)("XRViewer").sheet("Node Tree","Asset"),Te=Ae.object("helper",{cameraHelper:B.types.boolean(!1),polarHelper:B.types.boolean(!0),dotHelper:B.types.boolean(!1),quality:B.types.stringLiteral(2,{1:"x1",2:"x2",3:"x3"})}),De=(0,s.forwardRef)((function(e,t){var n=e.containerRef,r=e.figmaData,o=e.isQuery,i=e.isFigma,a=e.loadingProgress,c=(0,s.useRef)(null),u=(0,s.useRef)(null),l=(0,s.useRef)(Te),f=(0,d.z)(),p=f.invalidate,m=f.scene,v=f.gl,g=f.camera;(0,s.useImperativeHandle)(t,(function(){return{saveImage:function(){m.background=null;var e=function(e,t,n,r,o,i){return I(void 0,void 0,void 0,ee().mark((function a(){var c,u,l,s,f;return ee().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,s=1*(u=e),f=1*(l=t),2===n&&(s=1*u,f=1*l),3===n&&(s=2*u,f=2*l),1===n&&(s=.5*u,f=.5*l),i.aspect=s/f,i.updateProjectionMatrix(),o.setSize(s,f),o.render(r,i,null,!1),c=o.domElement.toDataURL("image/png"),i.aspect=u/l,i.updateProjectionMatrix(),o.setSize(u,l),a.abrupt("return",c);case 20:return a.prev=20,a.t0=a.catch(0),console.log(a.t0),a.abrupt("return");case 24:case"end":return a.stop()}}),a,null,[[0,20]])})))}(n.current.clientWidth,n.current.clientHeight,Number(Te.value.quality),m,v,g);return m.background=new h.Color("#272730"),e}}}));var y=(0,s.useCallback)((function(){var e=0!=r.length?r[0].height/r[0].width:.5625;console.log("the screen aspect ratio is : "+e),function(e,t,n,r,o,i){var a=C(t.children,0,"CameraHelper"),c=new e.PolarGridHelper(4*o,8,4,64,16777215,16777215);c.position.y=-r/2*o,c.position.z=o,c.visible=n.current.value.polarHelper,t.add(c);var u=new e.PlaneGeometry(8*o,8*o,Math.min(250,Math.max(40,8*o*5)),Math.min(250,Math.max(40,8*o*5)));u.rotateX(Math.PI/2);var l=new e.PointsMaterial({transparent:!1,fog:!1});l.map=function(e,t,n){var r=document.createElement("canvas");r.width=r.height=n;var o=r.getContext("2d"),i=new e.Texture(r);i.magFilter=e.LinearFilter,i.minFilter=e.LinearMipMapLinearFilter;var a=n/2;return o.beginPath(),o.arc(a,a,n/2,0,2*Math.PI,!1),o.closePath(),o.fillStyle="#ffffff",o.fill(),i.generateMipmaps=!0,i.needsUpdate=!0,i}(e,0,8*o),l.size=.00825;var s=new e.Points(u,l);s.position.y=-r/2*o,s.position.z=o,s.visible=n.current.value.dotHelper,t.add(s),i(a,c,s)}(h,m,l,e,_e,(function(e,t,n){l.current.onValuesChange((function(r){e.visible=r.cameraHelper,t.visible=r.polarHelper,n.visible=r.dotHelper,p()}))})),function(e,t){var n=document.getElementById("theatrejs-studio-root").shadowRoot.children[1].children[0].children[1].children[0].children[1],r=e.children,o=C(r,0,"CameraHelper");n.addEventListener("click",(function(i){return r.includes(o)?(i.stopPropagation(),new Promise((function(e,n){console.log("remove step 1 - remove helper first"),o.removeFromParent(),t(),setTimeout((function(){return e(1)}),1)})).then((function(e){console.log("remove step 2 - click btn second"),n.children[1].click()}))):(console.log("remove step 3 - snapshot opened"),setTimeout((function(){var n=document.getElementById("theatrejs-studio-root").shadowRoot.children[1].children[0].children[2].children[8].children[0].children[0];n.addEventListener("click",(function i(){return r.includes(o)||new Promise((function(e,t){console.log("add step 1 - close window first"),setTimeout((function(){return e(1)}),1)})).then((function(n){console.log("add step 2 - add camHelper"),e.add(o),t()})),n.removeEventListener("click",i),!0}))}),1)),!0}))}(m,p)}),[]);return(0,s.useEffect)((function(){if(!0===o){var e=2===a.split("/").length,t=a.split("/")[0]===a.split("/")[1];e&&t&&y()}else y()}),[o,a]),(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(ke.H,{shadows:!1,preset:"rembrandt",intensity:1,environment:"sunset",children:(0,k.jsxs)(F.yR,{sheet:Fe,children:[(0,k.jsx)("ambientLight",{}),(0,k.jsx)(U,{containerRef:n,cameraRef:c,cameraSheetObj:u,baseUnit:_e}),(0,k.jsx)(R,{cameraSheetObj:u.current}),!1===i?(0,k.jsx)(H,{cameraRef:c,cameraSheetObj:u,children:(0,k.jsx)(F.yR,{sheet:Fe,children:(0,k.jsx)($,{figmaData:r,isFigma:i,isQuery:o,baseUnit:_e})})}):(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(F.yR,{sheet:Fe,children:(0,k.jsx)($,{figmaData:r,isFigma:i,isQuery:o,baseUnit:_e})})})]})})})}));const Ue=function(){var e=(0,s.useRef)(null),t=(0,s.useRef)(null),n=(0,s.useRef)(null),r=Pe((0,s.useState)([]),2),o=r[0],i=r[1],a=Pe((0,s.useState)(!1),2),c=a[0],u=a[1],l=Pe((0,s.useState)(!1),2),f=l[0],d=l[1],v=Pe((0,s.useState)(!1),2),g=v[0],O=v[1],P=Pe((0,s.useState)("0"),2),R=P[0],_=P[1],A=(0,s.useCallback)((function(e){var t=e.event,n=e.image,r=e.message,o=e.name;oe(t,n,r,o)}),[o]),F=(0,s.useCallback)((function(e){var t=e.event,n=e.isServe,r=e.data,o=e.imageLayout;me(t,n,r,o)}),[]),T=(0,s.useCallback)((function(){console.log("successed - init with empty data"),O(!1)}),[]),D=(0,s.useCallback)((function(e){console.log("init with saved data"),u(!1),d(!1),i(e),O(!1)}),[]),U=(0,s.useCallback)((function(e,t){if("selection"===e){if(!t)return console.log("failed - no figma selection"),function(){};console.log("successed - init with figma data"),d(!1),O(!0);for(var n=0;n<t.data.length;n++){var r=n;t.data[r].src=URL.createObjectURL(new Blob([t.data[r].imageData],{type:"image/png"})),n===t.data.length-1&&(u(t.isFigma),i(t.data),O(!1))}}if("failed"===e&&!t)return console.log("failed - get data failed"),function(){}}),[]),z=(0,s.useCallback)((function(e,t,n){console.log("successed - init with query data"),u(!1),d(!0),O(!0);var r=function(e){for(var t=0;t<e.length;t++)(e[t].name.includes(".glb")||e[t].name.includes(".gltf"))&&(e[t].modelSrc=e[t].name,e[t].name=e[t].name.split("/")[e[t].name.split("/").length-1]),t===e.length-1&&(i(e),O(!1))};"auth_everytime"===e?(console.log("query - need OAuth"),new Oe.p({clientId:"2beFW69qeg7DvjBp6bKpm5",clientSecrete:"013RerD24yjKxvSIrUr4f6dESMYST8",redirectUri:"".concat("https://www.martinrgb.com/FigmaImporter/v4/","callback.html")}).getOAuth2Token().then((function(e){Le(e,t,n,(function(e){_(e)}),(function(e){r(e)}))}))):(console.log("query - already exist OAuth"),Le(e,t,n,(function(e){_(e)}),(function(e){r(e)})))}),[]);return s.useEffect((function(){var e=new URL(window.location.href),t=e.searchParams.get("query_key"),n=e.searchParams.get("query_node"),r=e.searchParams.get("query_token");console.log("fileKey is: "+t),console.log("nodeId is: "+n),console.log("token is: "+r),""!=savedFigData?D(savedFigData):null!=t&&null!=n?z(r,t,n):T(),window.onmessage=function(e){if(null!=e.data.pluginMessage){var t=e.data.pluginMessage,n=t.type,r=t.value;U(n,r)}}}),[]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(y,{}),g?(0,k.jsx)(E.Z,{loadingProgress:"".concat(R),hintText:" of total nodes is loaded"}):(0,k.jsx)(b,{children:(0,k.jsx)(L,{ref:e,children:(0,k.jsxs)(s.Suspense,{fallback:(0,k.jsx)(E.Z,{hintText:"init the renderer"}),children:[(0,k.jsx)(x,{ref:n,children:o.reverse().map((function(e){var t=e.src,n=e.type,r=e.index,o=e.name;return(0,k.jsx)(w,{src:t,className:"img-imported",id:n+"-"+r,name:o},n+"-"+r)}))}),(0,k.jsx)(j,{children:c?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(S,{onClick:function(e){A({event:e,image:t.current.saveImage(),message:"save-canvas-image",name:o[0].name})},children:"SaveToFigma"}),(0,k.jsx)(S,{onClick:function(e){F({event:e,isServe:!0,data:o,imageLayout:n.current})},children:"Download(Serve)"}),(0,k.jsx)(S,{onClick:function(e){F({event:e,isServe:!1,data:o,imageLayout:n.current})},children:"Download(Static)"})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.vZ,{className:"xr-button",mode:"AR"}),(0,k.jsx)(m.vZ,{className:"xr-button",mode:"VR"})]})}),(0,k.jsx)(p.Xz,{frameloop:"demand",gl:{preserveDrawingBuffer:!0,outputEncoding:h.sRGBEncoding,antialias:!0,alpha:!0,logarithmicDepthBuffer:!0},children:(0,k.jsx)(De,{ref:t,containerRef:e,isFigma:c,isQuery:f,loadingProgress:R,figmaData:o.reverse()})})]})})})]})};var ze=n(2654),Me=n.n(ze),Ce=n(659);Me().initialize({usePersistentStorage:!1}),Me().extend(Ce.Z);var Ie=document.getElementById("react-page");(0,f.s)(Ie).render((0,k.jsx)(Ue,{}))}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}r.m=t,e=[],r.O=(t,n,o,i)=>{if(!n){var a=1/0;for(s=0;s<e.length;s++){for(var[n,o,i]=e[s],c=!0,u=0;u<n.length;u++)(!1&i||a>=i)&&Object.keys(r.O).every((e=>r.O[e](n[u])))?n.splice(u--,1):(c=!1,i<a&&(a=i));if(c){e.splice(s--,1);var l=o();void 0!==l&&(t=l)}}return t}i=i||0;for(var s=e.length;s>0&&e[s-1][2]>i;s--)e[s]=e[s-1];e[s]=[n,o,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={924:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,i,[a,c,u]=n,l=0;if(a.some((t=>0!==e[t]))){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(u)var s=u(r)}for(t&&t(n);l<a.length;l++)i=a[l],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(s)},n=self.webpackChunkXRViewer=self.webpackChunkXRViewer||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.nc=void 0;var o=r.O(void 0,[348,635,242,642],(()=>r(2608)));o=r.O(o)})();